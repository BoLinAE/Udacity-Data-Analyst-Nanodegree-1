geom_line(group =1, color = 'chocolate4')
cor.test(no_shows_by_month$absence_rate, no_shows_by_month$appt_month)
ggplot(aes(x = appt_day, y = 100*absence_rate), data = no_shows_by_day) + geom_point(color = 'red')  + labs(x = 'Day of Appointment', y = 'Absence Rate %', title='Absence Rate vs Appointment Day') + scale_x_continuous(breaks=seq(1,31,1)) + geom_line(color='blue')
cor.test(no_shows_by_day$appt_day, no_shows_by_day$absence_rate)
p1 <- ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2014)) + geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  + labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2014') + scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") + theme(axis.text.x  =element_text(angle = 70, hjust = 1))
p2 <- ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2015)) + geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2015') + scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") + theme(axis.text.x  =element_text(angle = 70, hjust = 1))
grid.arrange(p1, p2, ncol = 1)
mean(no_shows$status[no_shows$gender=='M'])
mean(no_shows$status[no_shows$gender=='F'])
mean(no_shows$status[no_shows$gender=='M'])
mean(no_shows$status[no_shows$gender=='F'])
100 * mean(no_shows$status[no_shows$gender=='M'])
100 * mean(no_shows$status[no_shows$gender=='F'])
ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2015)) +                  geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2015') +     scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") +
theme(axis.text.x  =element_text(angle = 70, hjust = 1)) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-12-25")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-12-25")), y= 60, label='Christmas'), size=3, angle=90,        vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-11-02")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-11-02")), y= 60, label='All Saints Day'), size=3, angle=90,        vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-05-01")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-05-01")), y= 60, label='May Day'), size=3, angle=90,        vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-09-07")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-09-07")), y= 60, label='Independence Day'), size=3,  angle=90, vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-02-16")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-02-16")), y= 60,label='Carnival'), size=3, angle=90,     vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-04-03")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-04-03")), y=60, label='Good Friday'), size=3, angle=90,        vjust=-0.4, hjust=0)
ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2014)) +                  geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2014') +     scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") +
theme(axis.text.x  =element_text(angle = 70, hjust = 1)) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-12-25")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2014-12-25")), y=60, label='Christmas'), size=3, angle=90,    vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-06-12")))), linetype = 2, color = 'green') +
geom_text(aes(x=(as.Date("2014-06-12")), y=60, label='World Cup Start'), size=3, angle=90,vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-07-13")))), linetype = 2, color = 'green') +
geom_text(aes(x=(as.Date("2014-07-13")), y=60, label='World Cup End'), size=3, angle=90,vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-04-21")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2014-04-21")), y=60, label='Tiradentes'), size=3,   angle=90, vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-03-04")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2014-03-04")), y=60, label='Carnival'), size=3, angle=90, vjust=-0.4, hjust=0)
100 * mean(no_shows$status[no_shows$appt_year==2014])
100 * mean(no_shows$status[no_shows$appt_year==2014])
100 * mean(no_shows$status[no_shows$appt_date < "2014-07-13" & no_shows$appt_date > "2014-06-12"])
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 1.2) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(0.15, 0.45, 0.05)) + coord_cartesian(ylim=c(0.15,0.45))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 1.1) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(0.15, 0.45, 0.05)) + coord_cartesian(ylim=c(0.15,0.45))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 0.8) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(0.15, 0.45, 0.05)) + coord_cartesian(ylim=c(0.15,0.45))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= 100*status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 0.8) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(0.15, 0.45, 0.05)) + coord_cartesian(ylim=c(0.15,0.45))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= 100*status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 0.8) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(015, 045, 05)) + coord_cartesian(ylim=c(0.15,0.45))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= 100*status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 0.8) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(015, 045, 05)) + coord_cartesian(ylim=c(15,45))
table(no_shows$weekday)
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= 100*status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 0.8) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(015, 045, 05)) + coord_cartesian(ylim=c(15,45))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:6)),
y= relative_absence_rate) , data = no_shows_by_weekday) +
geom_bar(stat='identity', color='black', lwd= 1.2, fill = 'darkgoldenrod4') + labs(x='Day of Week', y= 'Relative Absence Rate (%)', title ='Relative Absence Rate by Day of Week') + coord_cartesian(ylim=c(-5,7))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:6)),
y= relative_absence_rate) , data = no_shows_by_weekday) +
geom_bar(stat='identity', color='black', lwd= 1.2, fill = 'darkgoldenrod3') + labs(x='Day of Week', y= 'Relative Absence Rate (%)', title ='Relative Absence Rate by Day of Week') + coord_cartesian(ylim=c(-5,7))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:6)),
y= relative_absence_rate) , data = no_shows_by_weekday) +
geom_bar(stat='identity', color='black', lwd= 1.2, fill = 'darkgoldenrod3', width = 1) + labs(x='Day of Week', y= 'Relative Absence Rate (%)', title ='Relative Absence Rate by Day of Week') + coord_cartesian(ylim=c(-5,7))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:6)),
y= relative_absence_rate) , data = no_shows_by_weekday) +
geom_bar(stat='identity', color='black', lwd= 1.2, fill = 'darkgoldenrod3', width = 0.8) + labs(x='Day of Week', y= 'Relative Absence Rate (%)', title ='Relative Absence Rate by Day of Week') + coord_cartesian(ylim=c(-5,7))
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:6)),
y= relative_absence_rate) , data = no_shows_by_weekday) +
geom_bar(stat='identity', color='black', lwd= 1, fill = 'darkgoldenrod3', width = 1) + labs(x='Day of Week', y= 'Relative Absence Rate (%)', title ='Relative Absence Rate by Day of Week') + coord_cartesian(ylim=c(-5,7))
ggplot(aes(x = age, y = 100*absence_rate), data = no_shows_by_age) + geom_line(color='blue') + geom_point() +
labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient')
# Set up R markdown
knitr::opts_chunk$set(echo = TRUE)
# Load in required packages
suppressMessages(library(ggplot2))
suppressMessages(library(plyr))
suppressMessages(library(dplyr))
suppressMessages(library(reshape2))
suppressMessages(library(Hmisc))
suppressMessages(library(GGally))
# Read in the data
no_shows <- read.csv('noshows.csv')
str(no_shows)
# Create numeric factors out of the two levels in status field
no_shows['Status'] <- lapply(no_shows['Status'], factor,  levels=c("Show-Up", "No-Show"), labels = c(0, 1))
# Change the factors in the the status column into 1: patient missed appointment and 0: patient attended appointment
no_shows$Status <- as.integer(as.character(no_shows$Status))
# Remove characters from dates and convert into date objects
no_shows$AppointmentDate <-gsub(pattern = "[A-Z]", replacement = " ", x = no_shows$AppointmentDate)
no_shows$AppointmentRegistrationDate <- gsub(pattern = "[A-Z]", replacement = " ", x = no_shows$AppointmentRegistrationDate)
no_shows$AppointmentDate <- as.Date(no_shows$AppointmentDate)
no_shows$AppointmentRegistrationDate <- as.Date(no_shows$AppointmentRegistrationDate)
str(no_shows)
# Extract month, year, and day from appointment date and create new columns
no_shows <-transform(no_shows, month = format(AppointmentDate, "%m"))
no_shows <- transform(no_shows, year = format(AppointmentDate, "%Y"))
no_shows <- transform(no_shows, day = format(AppointmentDate, "%d"))
no_shows$year <- as.integer(as.character(no_shows$year))
no_shows$month <- as.integer(as.character(no_shows$month))
no_shows$day <- as.integer(as.character(no_shows$day))
# Clarify and simply column names
no_shows <- plyr::rename(no_shows, c("Age" = "age",
"Gender" = "gender",
"AppointmentRegistrationDate" = "appt_reg_date",
"AppointmentDate" = "appt_date",
"DayOfTheWeek" = "weekday",
"Status" = "status",
"Diabetes" = "diabetes",
"Alcoholism" = "alcoholism",
"Hypertension" = "hypertension",
"Smoker" = "smoker",
"Scholarship" = "welfare",
"Tuberculosis" = "tuberculosis",
"SmsReminder" = "sms_reminder",
"WaitingTime" = "wait",
"month" = "appt_month",
"year" = "appt_year",
"day" = "appt_day"))
# Look at the summary of statistics for the dataframe
summary(no_shows)
# Filter out ages below 0
no_shows <- filter(no_shows, age >= 0)
# Set all titles in plots to be centered
theme_update(plot.title=element_text(hjust = 0.5))
# Create histogram of ages
qplot(x = age, data = no_shows, color = I('black') , fill = I('blue'), binwidth = 1) + theme(legend.position="None") +
labs(x='Age', y="Number of Patients", title='Frequency Distriution of Ages') + scale_x_continuous(breaks=seq(0,110, 10))
# Group the main dataframe by age and calculate the number of occurences of each age
no_shows_by_age <- group_by(no_shows, age)
no_shows_by_age <- dplyr::summarize(no_shows_by_age,
n = n())
# Add field with percentage of all patients
no_shows_by_age$pct <- 100* no_shows_by_age$n / nrow(no_shows)
# Create the bar plot
ggplot(aes(x = age, y = pct), data = no_shows_by_age) + geom_bar(stat='identity', color = 'black', fill = 'blue') +
labs(x = 'Age', y= '% of All Patients', title='Age Breakdown of Patients') + scale_y_continuous(breaks=seq(0,4,0.50)) +
scale_x_continuous(breaks=seq(0,110, 10))
# Calculate percentage of patients with an age of 0
nrow(subset(no_shows, age == 0)) / nrow(no_shows) * 100
# Create histogram for waiting time
qplot(x = wait, data = no_shows, color = I('black'), fill= I('darkorange3'), binwidth = 5) + labs(x='Waiting Time in Days', y = 'Number of Visits', title='Wait Time Frequency Distribution') + scale_y_continuous(breaks=seq(0,90000, 15000)) + scale_x_continuous(breaks=seq(0, 400, 20))
# Subset the data and count the rows
nrow(subset(no_shows, wait > 365))
nrow(subset(no_shows, wait > 180))
# Remover wait time over one year
no_shows <- filter(no_shows, wait < 365)
# Create a new dataframe by grouping and find the statistics
no_shows_by_wait <- group_by(no_shows, wait)
no_shows_by_wait <- dplyr::summarize(no_shows_by_wait,
n = n())
# Find the wait time percentage of all appointments
no_shows_by_wait$pct <- 100 * no_shows_by_wait$n / nrow(no_shows)
# Plot the data as a bar plot
ggplot(aes(x = wait, y = pct), data = no_shows_by_wait) + geom_bar(stat= 'identity', color = 'black', fill = 'darkslategrey') + labs(x='Waiting Time in Days', y = '% of All Visits', title='Wait Time Pct Breakdown') + coord_cartesian(xlim=c(0,90)) + scale_x_continuous(breaks=seq(0,90,5))
# Find correlations between the selected fields (numeric fields only were chosen)
ccs <- as.matrix(no_shows[,c(1, 6:17)])
rcorr(ccs, type='pearson')[1]
# Create a new dataframe grouped by month and calculate the statistics
no_shows_by_month <- group_by(no_shows, appt_month)
no_shows_by_month <- dplyr::summarize(no_shows_by_month,
absence_rate = mean(status),
n = n())
# Structure labels for plotting and create the No-Show rate vs month plot
month_labels = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul' , 'Aug', 'Sep', 'Oct', 'Nov' , 'Dec')
no_shows_by_month$month_name <- month_labels
no_shows_by_month$month_name <- factor(no_shows_by_month$month_name, levels=unique(no_shows_by_month$month_name))
ggplot(aes(x = month_name, y = 100* absence_rate), data = no_shows_by_month) + geom_point(color = 'red')  +
labs(x = 'Appointment Month', y = 'Absence Rate %', title='Absence Rate vs Appointment Month') +               theme(axis.text.x=element_text(angle = 60, face = "bold", size = 10, hjust=1)) +
geom_line(group =1, color = 'chocolate4')
cor.test(no_shows_by_month$absence_rate, no_shows_by_month$appt_month)
no_shows_by_day <- group_by(no_shows, appt_day)
no_shows_by_day <- dplyr::summarize(no_shows_by_day,
absence_rate = mean(status),
n = n())
ggplot(aes(x = appt_day, y = 100*absence_rate), data = no_shows_by_day) + geom_point(color = 'red')  + labs(x = 'Day of Appointment', y = 'Absence Rate %', title='Absence Rate vs Appointment Day') + scale_x_continuous(breaks=seq(1,31,1)) + geom_line(color='blue')
cor.test(no_shows_by_day$appt_day, no_shows_by_day$absence_rate)
# Load in gridExtra library for multiple plots
suppressMessages(library(gridExtra))
# First plot for 2014
p1 <- ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2014)) + geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  + labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2014') + scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") + theme(axis.text.x  =element_text(angle = 70, hjust = 1))
# Second plot for 2015
p2 <- ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2015)) + geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2015') + scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") + theme(axis.text.x  =element_text(angle = 70, hjust = 1))
grid.arrange(p1, p2, ncol = 1)
# Calculate absence rate by gender
100 * mean(no_shows$status[no_shows$gender=='M'])
100 * mean(no_shows$status[no_shows$gender=='F'])
# First for the 2015 plot
ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2015)) +                  geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2015') +     scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") +
theme(axis.text.x  =element_text(angle = 70, hjust = 1)) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-12-25")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-12-25")), y= 60, label='Christmas'), size=3, angle=90,        vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-11-02")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-11-02")), y= 60, label='All Saints Day'), size=3, angle=90,        vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-05-01")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-05-01")), y= 60, label='May Day'), size=3, angle=90,        vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-09-07")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-09-07")), y= 60, label='Independence Day'), size=3,  angle=90, vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-02-16")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-02-16")), y= 60,label='Carnival'), size=3, angle=90,     vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2015-04-03")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2015-04-03")), y=60, label='Good Friday'), size=3, angle=90,        vjust=-0.4, hjust=0)
ggplot(aes(x = appt_date, y = 100*status), data = subset(no_shows, appt_year == 2014)) +                  geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2014') +     scale_x_date(date_breaks = "1 month", date_labels = "%m-%d") +
theme(axis.text.x  =element_text(angle = 70, hjust = 1)) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-12-25")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2014-12-25")), y=60, label='Christmas'), size=3, angle=90,    vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-06-12")))), linetype = 2, color = 'green') +
geom_text(aes(x=(as.Date("2014-06-12")), y=60, label='World Cup Start'), size=3, angle=90,vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-07-13")))), linetype = 2, color = 'green') +
geom_text(aes(x=(as.Date("2014-07-13")), y=60, label='World Cup End'), size=3, angle=90,vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-04-21")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2014-04-21")), y=60, label='Tiradentes'), size=3,   angle=90, vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-03-04")))), linetype = 2, color = 'brown') +
geom_text(aes(x=(as.Date("2014-03-04")), y=60, label='Carnival'), size=3, angle=90, vjust=-0.4, hjust=0)
# Calculate mean absence rate during the world cup and for the entire year
100 * mean(no_shows$status[no_shows$appt_year==2014])
100 * mean(no_shows$status[no_shows$appt_date < "2014-07-13" & no_shows$appt_date > "2014-06-12"])
table(no_shows$weekday)
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:8)), y= 100*status), data = no_shows)+  geom_bar(stat= 'summary', fun.y = mean, color = 'black', fill = 'tan4', lwd = 0.8) +
labs(x='Appt. Day of the Week', y = 'Absence Rate %', title = 'Absence Rate vs Weekday') +
scale_y_continuous(breaks = seq(015, 045, 05)) + coord_cartesian(ylim=c(15,45))
days_of_week = c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
# Find mean absence rate of weekdays
weekday_mean = mean(no_shows$status[no_shows$weekday %in% days_of_week])
# Create a new dataframe with statistics for weekdays only
no_shows_by_weekday <- group_by(no_shows, weekday)
no_shows_by_weekday <- summarise(no_shows_by_weekday,
absence_rate = mean(status),
relative_absence_rate = 100*  (mean(status) - weekday_mean) / weekday_mean,
n = n())
no_shows_by_weekday <- filter(no_shows_by_weekday, weekday %in% days_of_week)
# Plot relative absence rate compared to mean by day of the week
ggplot(aes(x = factor(weekday, weekdays(as.Date('1970-01-03') + 2:6)),
y= relative_absence_rate) , data = no_shows_by_weekday) +
geom_bar(stat='identity', color='black', lwd= 1, fill = 'darkgoldenrod3', width = 1) + labs(x='Day of Week', y= 'Relative Absence Rate (%)', title ='Relative Absence Rate by Day of Week') + coord_cartesian(ylim=c(-5,7))
no_shows_by_age<-group_by(no_shows, age)
no_shows_by_age <- dplyr::summarize(no_shows_by_age,
absence_rate = mean(status),
n = n())
ggplot(aes(x = age, y = 100*absence_rate), data = no_shows_by_age) + geom_line(color='blue') + geom_point() +
labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient')
ggplot(aes(x = age, y = 100*absence_rate), data = no_shows_by_age) + geom_line(color='blue') + geom_point(size = 0.4) +
labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient')
ggplot(aes(x = age, y = 100*absence_rate), data = no_shows_by_age) + geom_line(color='blue') + geom_point(size = 0.6) +
labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient')
ggplot(aes(x = age, y = 100*absence_rate), data = no_shows_by_age) + geom_line(color='blue') + geom_point(size = 1) +
labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient')
ggplot(aes(x = age, y = 100*absence_rate), data = no_shows_by_age) + geom_line(color='blue') +
geom_point(size = 1) +  labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +   scale_x_continuous(breaks=seq(0,110,10))
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='green4', lwd = 1.6) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=mean(no_shows$status)), linetype = 4, color='red') +
labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y=0.308, label='Mean for All Ages'), size=4, color = 'red') + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='green4', lwd = 1.6) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='red') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y=0.308, label='Mean for All Ages'), size=4, color = 'red') + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='green4', lwd = 1.6) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='red') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 31, label='Mean for All Ages'), size=4, color = 'red') + geom_smooth(method='lm')
nrow(subset(no_shows, age > 90))
no_shows_by_age <- filter(no_shows_by_age, age < 90)
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='green4', lwd = 1.6) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='red') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 32, label='Mean for All Ages'), size=3, color = 'red') + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='green4', lwd = 1.6) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='red') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 30.5, label='Mean for All Ages'), size=3, color = 'red') + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='honeydew4', lwd = 1.2) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='red') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 30.5, label='Mean Absence Rate'), size=3, color = 'red') + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='khaki4', lwd = 1.2) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='red') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 30.5, label='Mean Absence Rate'), size=3, color = 'red') + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='khaki4', lwd = 1.2) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 4, color='black') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 30.5, label='Mean Absence Rate'), size=3) + geom_smooth(method='lm')
ggplot(aes(x = age, y = 100 *absence_rate), data = no_shows_by_age) + geom_line(color='khaki4', lwd = 1.2) + scale_x_continuous(breaks=seq(0,90,5)) + geom_hline(aes(yintercept=100*mean(no_shows$status)), linetype = 3, color='black') + labs(x = 'Age (yrs)', y = 'Absence Rate %' , title = 'Absence Rate vs Age of Patient') +  geom_text(aes(x = 75, y= 30.5, label='Mean Absence Rate'), size=3) + geom_smooth(method='lm')
no_shows_by_age[no_shows_by_age$absence_rate == max(no_shows_by_age$absence_rate),]
no_shows_by_age[no_shows_by_age$absence_rate == min(no_shows_by_age$absence_rate),]
cor.test(no_shows_by_age$age, no_shows_by_age$absence_rate)
ggplot(aes(x = age_bucket, y = relative_absence_rate), data= no_shows_by_age_bucket) +
geom_bar(stat='identity', color='black', fill = 'steelblue', lwd = 0.8, width=1) +
theme(axis.text.x=element_text(angle = 60, hjust=1)) + labs(x = 'Age Group', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Age Group') + scale_y_continuous(breaks=seq(-40, 40, 10))
ggplot(aes(x = age_bucket, y = relative_absence_rate), data= no_shows_by_age_bucket) +
geom_bar(stat='identity', color='black', fill = 'steelblue', lwd = 0.8, width=0.9) +
theme(axis.text.x=element_text(angle = 60, hjust=1)) + labs(x = 'Age Group', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Age Group') + scale_y_continuous(breaks=seq(-40, 40, 10))
ggplot(aes(x = age_bucket, y = relative_absence_rate), data= no_shows_by_age_bucket) +
geom_bar(stat='identity', color='black', fill = 'steelblue', lwd = 0.8, width=1) +
theme(axis.text.x=element_text(angle = 60, hjust=1)) + labs(x = 'Age Group', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Age Group') + scale_y_continuous(breaks=seq(-40, 40, 10))
ggplot(aes(x = wait, y = absence_rate), data = no_shows_by_wait) + geom_point(color='navy') +
labs(x = 'Wait (days)' , y = 'Absence Rate', title = 'Absence Rate vs Waiting Time')
no_shows_by_wait <- group_by(no_shows, wait)
no_shows_by_wait <- dplyr::summarize(no_shows_by_wait,
absence_rate = mean(status),
n = n())
ggplot(aes(x = wait, y = absence_rate), data = no_shows_by_wait) + geom_point(color='navy') +
labs(x = 'Wait (days)' , y = 'Absence Rate', title = 'Absence Rate vs Waiting Time')
cor.test(no_shows_by_wait$absence_rate, no_shows_by_wait$wait)
ggplot(aes(x = wait, y = absence_rate), data = no_shows_by_wait) + geom_point(color='cadetblue') +
labs(x = 'Wait (days)' , y = 'Absence Rate', title = 'Absence Rate vs Waiting Time')
ggplot(aes(x = wait, y = absence_rate), data = no_shows_by_wait) + geom_point(color='cadetblue2') +
labs(x = 'Wait (days)' , y = 'Absence Rate', title = 'Absence Rate vs Waiting Time')
ggplot(aes(x = wait, y = absence_rate), data = no_shows_by_wait) + geom_point(color='darkslateblue') +
labs(x = 'Wait (days)' , y = 'Absence Rate', title = 'Absence Rate vs Waiting Time')
ggplot(aes(x = wait, y = 100 * absence_rate), data = no_shows_by_wait) + geom_point(color='darkslateblue') +
labs(x = 'Wait (days)' , y = 'Absence Rate %', title = 'Absence Rate vs Waiting Time')
ggplot(aes(x = wait, y = 100 * absence_rate), data = no_shows_by_wait) + geom_point(color='darkslateblue') +
labs(x = 'Wait (days)' , y = 'Absence Rate %', title = 'Absence Rate vs Waiting Time')
cor.test(no_shows_by_wait$absence_rate, no_shows_by_wait$wait)
ggplot(aes(x = wait_bucket, y = relative_absence_rate), data = no_shows_by_wait_bucket) +
geom_bar(stat='identity', color='black', fill='red4', lwd = 0.8, width = 1) +
scale_y_continuous(breaks=seq(-30, 20, 5)) +
labs(x = 'Wait Time Group (days)', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Waiting Time  Group')
nrow(subset(no_shows, wait > 90))
no_shows_by_wait <- filter(no_shows_by_wait, wait< 90)
no_shows_by_wait$wait_bucket <- cut(no_shows_by_wait$wait, breaks = seq(0,90,10), include.lowest = TRUE)
no_shows_by_wait_bucket <- group_by(no_shows_by_wait, wait_bucket)
no_shows_by_wait_bucket <- dplyr::summarize(no_shows_by_wait_bucket,
absence_rate = mean(absence_rate),
n = n())
no_shows_by_wait_bucket$relative_absence_rate <- with(no_shows_by_wait_bucket, 100 *(absence_rate - mean(absence_rate)) / mean(absence_rate))
ggplot(aes(x = wait_bucket, y = relative_absence_rate), data = no_shows_by_wait_bucket) +
geom_bar(stat='identity', color='black', fill='red4', lwd = 0.8, width = 1) +
scale_y_continuous(breaks=seq(-30, 20, 5)) +
labs(x = 'Wait Time Group (days)', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Waiting Time  Group')
ggplot(aes(x = sms_reminder, y = 100 * absence_rate), data = no_shows_by_sms) +
geom_bar(stat='identity', color='black', fill='peru') +
labs(x = 'Number of SMS Reminders', y = 'Absence Rate %' , title = 'Absence Rate vs Number of SMS Reminders') +     geom_text(aes(label = sprintf("%0.4f", absence_rate), y = absence_rate + 0.026), size = 4, hjust = 0.5, vjust =   3) + coord_cartesian(ylim=c(0.2,0.4)) + scale_y_continuous(breaks=seq(0.2, 0.4, 0.05))
ggplot(aes(x = sms_reminder, y = 100 * absence_rate), data = no_shows_by_sms) +
geom_bar(stat='identity', color='black', fill='peru') +
labs(x = 'Number of SMS Reminders', y = 'Absence Rate %' , title = 'Absence Rate vs Number of SMS Reminders') +     geom_text(aes(label = sprintf("%0.4f", absence_rate), y = 100* absence_rate + 0.026), size = 4, hjust = 0.5, vjust =   3) + coord_cartesian(ylim=c(0.2,0.4)) + scale_y_continuous(breaks=seq(020, 040, 05))
ggplot(aes(x = sms_reminder, y = 100 * absence_rate), data = no_shows_by_sms) +
geom_bar(stat='identity', color='black', fill='peru') +
labs(x = 'Number of SMS Reminders', y = 'Absence Rate %' , title = 'Absence Rate vs Number of SMS Reminders') +     geom_text(aes(label = sprintf("%0.4f", absence_rate), y = 100* absence_rate + 0.026), size = 4, hjust = 0.5, vjust =   3) + coord_cartesian(ylim=c(20,40)) + scale_y_continuous(breaks=seq(020, 040, 05))
ggplot(aes(x = sms_reminder, y = 100 * absence_rate), data = no_shows_by_sms) +
geom_bar(stat='identity', color='black', fill='peru') +
labs(x = 'Number of SMS Reminders', y = 'Absence Rate %' , title = 'Absence Rate vs Number of SMS Reminders') +     geom_text(aes(label = sprintf("%0.4f", absence_rate), y = 100* absence_rate + 2.6), size = 4, hjust = 0.5, vjust =   3) + coord_cartesian(ylim=c(20,40)) + scale_y_continuous(breaks=seq(020, 040, 05))
ggplot(aes(x = sms_reminder, y = 100 * absence_rate), data = no_shows_by_sms) +
geom_bar(stat='identity', color='black', fill='peru') +
labs(x = 'Number of SMS Reminders', y = 'Absence Rate %' , title = 'Absence Rate vs Number of SMS Reminders') +     geom_text(aes(label = sprintf("%0.4f", 100 *absence_rate), y = 100* absence_rate + 2.6), size = 4, hjust = 0.5, vjust =   3) + coord_cartesian(ylim=c(20,40)) + scale_y_continuous(breaks=seq(020, 040, 05))
ggplot(aes(x = sms_reminder, y = 100 * absence_rate), data = no_shows_by_sms) +
geom_bar(stat='identity', color='black', fill='peru') +
labs(x = 'Number of SMS Reminders', y = 'Absence Rate %' , title = 'Absence Rate vs Number of SMS Reminders') +     geom_text(aes(label = sprintf("%0.2f", 100 *absence_rate), y = 100* absence_rate + 2.6), size = 4, hjust = 0.5, vjust =   3) + coord_cartesian(ylim=c(20,40)) + scale_y_continuous(breaks=seq(020, 040, 05))
ggplot(aes(x = age, y = sms_reminder), data = subset(no_shows, age < 90)) + geom_line(stat='summary', fun.y = mean, color='red') + labs(x = 'Age (yrs)', y = 'Average Number of SMS Reminders', title='Average SMS Reminders vs Age' ) + scale_x_continuous(breaks= seq(0,90, 10)) + geom_smooth(method = 'lm')
ggplot(aes(x = age, y = sms_reminder), data = subset(no_shows, age < 90)) + geom_line(stat='summary', fun.y = mean, color='red') + labs(x = 'Age (yrs)', y = 'Number of SMS Reminders', title='Average SMS Reminders vs Age' ) + scale_x_continuous(breaks= seq(0,90, 10)) + geom_smooth(method = 'lm') + coord_cartesian(ylim=c(0.4,0.7))
ggplot(aes(x = age, y = sms_reminder), data = subset(no_shows, age < 90)) + geom_line(stat='summary', fun.y = mean, color='red') + labs(x = 'Age (yrs)', y = 'Number of SMS Reminders', title='Average SMS Reminders vs Age' ) + scale_x_continuous(breaks= seq(0,90, 10)) + geom_smooth(method = 'lm') + coord_cartesian(ylim=c(0.4,0.65))
ggplot(aes(x = age, y = sms_reminder), data = subset(no_shows, age < 90)) + geom_line(stat='summary', fun.y = mean, color='red') + labs(x = 'Age (yrs)', y = 'Number of SMS Reminders Per Visit', title='Average SMS Reminders vs Age' ) + scale_x_continuous(breaks= seq(0,90, 10)) + geom_smooth(method = 'lm') + coord_cartesian(ylim=c(0.4,0.65))
cor.test(no_shows_by_age_texts$average_reminders, no_shows_by_age_texts$age)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Reminders' ) + scale_color_discrete(name='Num of SMS Reminders')
no_shows_by_age_texts <- group_by(no_shows, age)
no_shows_by_age_texts <- filter(no_shows_by_age_texts, age < 90)
no_shows_by_age_texts$sms_reminder <- factor(no_shows_by_age_texts$sms_reminder)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Reminders' ) + scale_color_discrete(name='Num of SMS Reminders')
no_shows_no_reminder <- no_shows[no_shows$sms_reminder == 0 & no_shows$age < 90,]
no_shows_with_reminder <- no_shows[no_shows$sms_reminder > 0 & no_shows$age < 90 ,]
no_shows_no_reminder <- group_by(no_shows_no_reminder, age)
no_shows_with_reminder <- group_by(no_shows_with_reminder, age)
no_shows_no_reminder <- dplyr::summarize(no_shows_no_reminder,
absence_rate_no_reminder = mean(status))
no_shows_with_reminder <- dplyr::summarize(no_shows_with_reminder,
absence_rate_with_reminder = mean(status))
no_shows_reminder <- merge(no_shows_no_reminder, no_shows_with_reminder, by = 'age')
no_shows_reminder <- transform(no_shows_reminder, diff = absence_rate_with_reminder - absence_rate_no_reminder)
ggplot(aes(x = age, y = 100* diff), data = no_shows_reminder) + geom_line(color = 'darkorange', lwd = 1.4) + labs(x='Age (yrs)' , y = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder (%)', title = 'Absence Rate Difference by Text Message Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_discrete(name='Num of SMS Reminders', palette = 3)
no_shows_by_age_texts <- group_by(no_shows, age)
no_shows_by_age_texts <- filter(no_shows_by_age_texts, age < 90)
no_shows_by_age_texts$sms_reminder <- factor(no_shows_by_age_texts$sms_reminder)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_discrete(name='Num of SMS Reminders', palette = 3)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_discrete(name='Num of SMS Reminders', values = 3)
?scale_color_discrete
```{r}
ggplot(aes(x = age, y = sms_reminder), data = subset(no_shows, age < 90)) + geom_line(stat='summary', fun.y = mean, color='red') + labs(x = 'Age (yrs)', y = 'Number of SMS Reminders Per Visit', title='Average SMS Reminders vs Age' ) + scale_x_continuous(breaks= seq(0,90, 10)) + geom_smooth(method = 'lm') + coord_cartesian(ylim=c(0.4,0.65))
no_shows_by_age_texts <- group_by(no_shows, age)
no_shows_by_age_texts$sms_reminder <- factor(no_shows_by_age_texts$sms_reminder)
no_shows_by_age_texts <- dplyr::summarize(no_shows_by_age_texts,
average_reminders = mean(as.numeric(as.character(sms_reminder))),
absence_rate = mean(status),
n = n())
cor.test(no_shows_by_age_texts$average_reminders, no_shows_by_age_texts$age)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_discrete(name='Num of SMS Reminders')
no_shows_by_age_texts <- group_by(no_shows, age)
no_shows_by_age_texts <- filter(no_shows_by_age_texts, age < 90)
no_shows_by_age_texts$sms_reminder <- factor(no_shows_by_age_texts$sms_reminder)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_age_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_discrete(name='Num of SMS Reminders')
no_shows_by_age_texts <- group_by(no_shows, age)
no_shows_by_age_texts <- filter(no_shows_by_age_texts, age < 90)
no_shows_by_age_texts <- dplyr::summarize(no_shows_by_age_texts,
average_reminders = mean(as.numeric(as.character(sms_reminder))),
absence_rate = mean(status),
n = n())
cor.test(no_shows_by_age_texts$average_reminders, no_shows_by_age_texts$age)
no_shows_by_texts <- group_by(no_shows, age)
no_shows_by_texts <- filter(no_shows_by_age_texts, age < 90)
no_shows_by_texts$sms_reminder <- factor(no_shows_by_texts$sms_reminder)
no_shows_by_texts <- filter(no_shows_by_texts, age < 90)
no_shows_by_texts <- group_by(no_shows, age)
no_shows_by_texts <- filter(no_shows_by_texts, age < 90)
no_shows_by_texts$sms_reminder <- factor(no_shows_by_texts$sms_reminder)
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_discrete(name='Num of SMS Reminders')
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_manual(name='Num of SMS Reminders', values=c('red','blue', 'orange'))
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_manual(name='Num of SMS Reminders', values=c('red','blue', 'slategrey4'))
ggplot(aes(x = age, y = 100 * status), data = no_shows_by_texts) + geom_line(aes(color=sms_reminder), stat = 'summary', fun.y = mean, lwd = 1.2) + labs(x = 'Age (yrs)', y = 'Absence Rate %', title='Absence Rate vs Age by Text Reminders' ) + scale_color_manual(name='Num of SMS Reminders', values=c('red','blue', 'slategray4'))
no_shows_no_reminder <- no_shows[no_shows$sms_reminder == 0 & no_shows$age < 90,]
no_shows_with_reminder <- no_shows[no_shows$sms_reminder > 0 & no_shows$age < 90 ,]
no_shows_no_reminder <- group_by(no_shows_no_reminder, age)
no_shows_with_reminder <- group_by(no_shows_with_reminder, age)
ggplot(aes(x = age, y = 100 * diff), data = no_shows_reminder) + geom_line(color = 'tan4', lwd = 1.2) + labs(x='Age (yrs)' , y = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder (%)', title = 'Absence Rate Difference by Text Message Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
ggplot(aes(x = age, y = 100 * diff), data = no_shows_reminder) + geom_line(color = 'goldenrod4', lwd = 1.2) + labs(x='Age (yrs)' , y = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder (%)', title = 'Absence Rate Difference by Text Message Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
suppressMessages(library(zoo))
no_shows_reminder$diff <- rollmean(no_shows_reminder$diff, 5, fill = NA)
ggplot(aes(x = age, y = 100 * diff), data = no_shows_reminder) + geom_line(color = 'goldenrod4', lwd = 1.2) + labs(x='Age (yrs)' , y = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder (%)', title = 'Absence Rate Difference by Text Message Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
ggplot(aes(x = age, y = 100 * diff), data = no_shows_reminder) + geom_line(color = 'goldenrod4', lwd = 1.2) + labs(x='Age (yrs)' , y = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder', title = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
ggplot(aes(x = age, y = 100 * diff), data = no_shows_reminder) + geom_line(color = 'goldenrod4', lwd = 1.2) + labs(x='Age (yrs)' , y = 'With Reminder - Without Reminder', title = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
ggplot(aes(x = age, y = 100 * diff), data = no_shows_reminder) + geom_line(color = 'goldenrod4', lwd = 1.2) + labs(x='Age (yrs)' , y = 'Absence Rate With Reminder - Without Reminder ', title = 'Absence Rate w\\ Reminder - Absence Rate w\\o Reminder vs Age') + scale_x_continuous(breaks=seq(0,90,10))
conditions = colnames(no_shows[7:12])
absence_rates <- c(0,0,0,0,0,0)
no_shows_by_condition <- data.frame(absence_rate = c(0,0,0,0,0,0), counts = c(0,0,0,0,0,0), marker =  conditions)
for (i in seq(1, length(conditions))){
condition <- conditions[i]
no_shows_by_condition[i, 1] <- mean(no_shows$status[no_shows[, condition] == 1])
no_shows_by_condition[i, 2] <- table(no_shows[, condition] == 1)['TRUE']
}
ggplot(aes(x = marker, y = absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity', color = 'black', fill = 'goldenrod4') + labs(x='Marker', y= 'Absence Rate' , title = 'Absence Rate vs Marker') +
scale_y_continuous(breaks = seq(0.2, 0.4, 0.02)) + coord_cartesian(ylim = c(0.2,0.4)) +
geom_text(aes(label = sprintf("%0.4f", absence_rate), y = absence_rate + 0.024), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y = 100 * absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity', color = 'black', fill = 'goldenrod4') + labs(x='Marker', y= 'Absence Rate %' , title = 'Absence Rate vs Marker') +
scale_y_continuous(breaks = seq(0.2, 0.4, 0.02)) + coord_cartesian(ylim = c(0.2,0.4)) +
geom_text(aes(label = sprintf("%0.4f", absence_rate), y = absence_rate + 0.024), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y = 100 * absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity', color = 'black', fill = 'goldenrod4') + labs(x='Marker', y= 'Absence Rate %' , title = 'Absence Rate vs Marker') +
scale_y_continuous(breaks = seq(20, 20, 02)) + coord_cartesian(ylim = c(20,20)) +
geom_text(aes(label = sprintf("%0.4f", absence_rate), y = 100 * absence_rate + 2.4), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y = 100 * absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity', color = 'black', fill = 'goldenrod4') + labs(x='Marker', y= 'Absence Rate %' , title = 'Absence Rate vs Marker') +
scale_y_continuous(breaks = seq(20, 40, 02)) + coord_cartesian(ylim = c(20,20)) +
geom_text(aes(label = sprintf("%0.4f", absence_rate), y = 100 * absence_rate + 2.4), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y = 100 * absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity', color = 'black', fill = 'goldenrod4') + labs(x='Marker', y= 'Absence Rate %' , title = 'Absence Rate vs Marker') +
scale_y_continuous(breaks = seq(20, 40, 02)) + coord_cartesian(ylim = c(20,40)) +
geom_text(aes(label = sprintf("%0.4f", absence_rate), y = 100 * absence_rate + 2.4), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y = 100 * absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity', color = 'black', fill = 'goldenrod4') + labs(x='Marker', y= 'Absence Rate %' , title = 'Absence Rate vs Marker') +
scale_y_continuous(breaks = seq(20, 40, 02)) + coord_cartesian(ylim = c(20,40)) +
geom_text(aes(label = sprintf("%0.2f", 100 * absence_rate), y = 100 * absence_rate + 2.4), size = 4, hjust = 0.5, vjust = 3)
no_shows_by_condition$pct_of_vists <- 100 * no_shows_by_condition$counts / nrow(no_shows)
no_shows_by_condition
no_shows_by_condition$relative_absence_rate <- 100 * (no_shows_by_condition$absence_rate - mean(no_shows$status)) / mean(no_shows$status)
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) + geom_bar(stat='identity' , color = 'black', fill= 'lemonchiffon2') + labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5))
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) +
geom_bar(stat='identity' , color = 'black', fill= 'wheat4', width = 1) +
labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5))
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) +
geom_bar(stat='identity' , color = 'black', fill= 'wheat3', width = 1) +
labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5))
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) +
geom_bar(stat='identity' , color = 'black', fill= 'wheat3', width = 1) +
labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5)) + geom_text(aes(label = sprintf("%0.2f", relative_absence_rate), y = relative_absence_rate + 2.4), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) +
geom_bar(stat='identity' , color = 'black', fill= 'wheat3', width = 1) +
labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5)) + geom_text(aes(label = sprintf("%0.2f", relative_absence_rate), y = relative_absence_rate + 5), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) +
geom_bar(stat='identity' , color = 'black', fill= 'wheat3', width = 1) +
labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5)) + geom_text(aes(label = sprintf("%0.2f", relative_absence_rate), y = relative_absence_rate + 8), size = 4, hjust = 0.5, vjust = 3)
ggplot(aes(x = marker, y= relative_absence_rate), data = no_shows_by_condition) +
geom_bar(stat='identity' , color = 'black', fill= 'wheat3', width = 1) +
labs(x= 'Marker' , y= 'Relative Absence Rate %' , title= 'Relative Absence Rate vs. Marker') + scale_y_continuous(breaks = seq(-20, 40, 5)) + geom_text(aes(label = sprintf("%0.2f", relative_absence_rate), y = relative_absence_rate + 6.8), size = 4, hjust = 0.5, vjust = 3)
yearly_mean <- 100*mean(no_shows$status[no_shows$appt_year == 2014])
ggplot(aes(x = appt_date, y = 100 * status), data = subset(no_shows, appt_year == 2014)) +                          geom_point(aes(color = gender),stat = 'summary', fun.y = mean)  +
labs(x = 'Appt. Date (M-D)', y = 'Absence Rate %', title = 'Absence Rate vs. Day of Year 2014') +                 scale_x_date(date_breaks = "1 month", date_labels = "%b-%d")+
scale_color_manual(name='Gender', values =c('red3','royalblue3')) +
theme(axis.text.x  =element_text(angle = 70, hjust = 1)) +
scale_y_continuous(breaks=seq(0,100,20)) + coord_cartesian(ylim=c(0,100)) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-12-25")))), lwd = 1.1, linetype = 2, color = 'sienna4') +
geom_text(aes(x=(as.Date("2014-12-25")), y=65, label='Christmas'), size=3.6, angle=90, vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-06-12")))), lwd = 1.1,  linetype = 2, color = 'green4') +
geom_text(aes(x=(as.Date("2014-06-12")), y=65,label='World Cup Start'), size=3.6, angle=90,vjust=-0.4, hjust=0)+
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-07-13")))),lwd = 1.1,  linetype = 2, color = 'green4') +
geom_text(aes(x=(as.Date("2014-07-13")), y=65,label='World Cup End'), size=4, angle=90, vjust=-0.4, hjust=0)+
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-04-21")))), lwd = 1.1, linetype = 2, color = 'sienna4') +
geom_text(aes(x=(as.Date("2014-04-21")), y=65, label='Tiradentes'), size=3.6, angle=90, vjust=-0.4, hjust=0) +
geom_vline(aes(xintercept=(as.numeric(as.Date("2014-03-04")))), lwd = 1.1, linetype = 2, color = 'sienna4') +
geom_text(aes(x=(as.Date("2014-03-04")), y=65,label='Carnival'), size=3.6, angle=90, vjust=-0.4, hjust=0) +
geom_hline(aes(yintercept= yearly_mean), linetype = 1, lwd = 1.2)
no_shows_reminder$no_reminder_rolling_mean <- zoo::rollmean(no_shows_reminder$absence_rate_no_reminder, 5, fill = NA)
no_shows_reminder$reminder_rolling_mean <- zoo::rollmean(no_shows_reminder$absence_rate_with_reminder, 5, fill = NA)
ggplot(aes(x = age), data = no_shows_reminder) +
geom_line(aes(y = 100*reminder_rolling_mean, color = 'SMS Reminders'), lwd = 1.2) +
geom_line(aes(y = 100* no_reminder_rolling_mean, color = 'No SMS Reminders') , lwd = 1.2) +
labs(x='Age (yrs)' , y = 'Absence Rate (%)', title = 'Absence Rate vs Age by SMS Reminder') +                     scale_x_continuous(breaks=seq(0,90,10)) + scale_color_manual(name = '', values = c('darkorange', 'navy')) +
scale_y_continuous(breaks=seq(15,45,5)) + coord_cartesian(ylim=c(18,40))
ggplot(aes(x = wait_bucket, y = relative_absence_rate), data = no_shows_by_wait_bucket) +
geom_bar(stat='identity', color='black', fill='red4', lwd = 0.8) + scale_y_continuous(breaks=seq(-30, 20, 5)) +
labs(x = 'Wait Time Group (days)', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Waiting Time Group') + theme(axis.text.x = element_text(angle = 70, hjust = 1)) + geom_point(aes(y= pr)) + geom_line(aes(x = wait_bucket, y = pr, color='LOESS model prediction'), group = 1, lwd = 1) + scale_color_manual(name='', values = 'darkblue')
no_shows_by_wait <- group_by(subset(no_shows, wait < 90), wait)
no_shows_by_wait <- dplyr::summarize(no_shows_by_wait,
absence_rate = mean(status))
no_shows_by_wait <- transform(no_shows_by_wait, relative_absence_rate = 100 * (absence_rate - mean(absence_rate ))/ mean(absence_rate))
model <- loess(no_shows_by_wait$relative_absence_rate ~ no_shows_by_wait$wait)
pr <- predict(model, newdata=data.frame(wait=1:89))
no_shows_by_wait$pr <- pr
no_shows_by_wait$wait_bucket <- cut(no_shows_by_wait$wait, breaks = seq(0,90,3), include.lowest = TRUE)
no_shows_by_wait_bucket <- group_by(no_shows_by_wait, wait_bucket)
no_shows_by_wait_bucket <- dplyr::summarize(no_shows_by_wait_bucket,
absence_rate = mean(absence_rate),
pr = mean(pr),
n = n())
no_shows_by_wait_bucket$relative_absence_rate <- with(no_shows_by_wait_bucket, 100 *(absence_rate - mean(absence_rate)) / mean(absence_rate))
ggplot(aes(x = wait_bucket, y = relative_absence_rate), data = no_shows_by_wait_bucket) +
geom_bar(stat='identity', color='black', fill='red4', lwd = 0.8) + scale_y_continuous(breaks=seq(-30, 20, 5)) +
labs(x = 'Wait Time Group (days)', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Waiting Time Group') + theme(axis.text.x = element_text(angle = 70, hjust = 1)) + geom_point(aes(y= pr)) + geom_line(aes(x = wait_bucket, y = pr, color='LOESS model prediction'), group = 1, lwd = 1) + scale_color_manual(name='', values = 'darkblue')
ggplot(aes(x = wait_bucket, y = relative_absence_rate), data = no_shows_by_wait_bucket) +
geom_bar(stat='identity', color='black', fill='red4', lwd = 0.8) + scale_y_continuous(breaks=seq(-30, 20, 5)) +
labs(x = 'Wait Time Group (days)', y = 'Relative Absence Rate %', title = 'Relative Absence Rate vs Waiting Time Group') + theme(axis.text.x = element_text(angle = 70, hjust = 1)) + geom_point(aes(y= pr)) + geom_line(aes(x = wait_bucket, y = pr, color='LOESS model'), group = 1, lwd = 1) + scale_color_manual(name='', values = 'darkblue')
opts_chunk$set(fig.align='center')
install.packages('opts_chunk')
knitr::opts_chunk$set(fig.align='center')
