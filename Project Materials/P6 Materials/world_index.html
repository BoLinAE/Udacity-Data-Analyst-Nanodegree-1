<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
	<style>

	h2 {
		text-align: center;
	}

	</style>

	<script type="text/javascript">

	function draw(geographic_data){
		debugger;
			"use strict";
			var margin = 75,
					width = 1920 - margin,
					height = 1080 - margin;

			d3.select("body")
				.append("h2")
				.text("Emissions Explorer!")

			var svg = d3.select("body")
					.append("svg")
					.attr("width", width + margin)
					.attr("height", height + margin)
					.append("g")
					.attr("class", "map");

				var projection = d3.geo.eckert1()
						.scale(380)
						.translate([width / 2, height / 2]);

				var path = d3.geo.path().projection(projection);

				var map = svg.selectAll("path")
						.data(geographic_data.features)
						.enter()
						.append("path")
						.attr("d", path)
						.style("fill", "yellow")
						.style("opacity", 0.6)
						.style("stroke", "black")
						.style("stroke-width", 0.6);

				svg.selectAll("text")
						.data(geographic_data.features)
						.enter()
						.append("svg:text")
						.text(function(d) {
							return d.id;
						})
						.attr("x", function(d){
							return path.centroid(d)[0];
						})
						.attr("y", function(d){
							return path.centroid(d)[1];
						})
						.attr("text-anchor", "middle")
						.attr("font-size", "6pt");

				countries_loc = []

				for(var i=0; i<geographic_data.features.length; i+=1) {
						countries_loc[geographic_data.features[i].properties.name] = d3.geo.centroid(geographic_data.features[i])
				}

				debugger;

		function plot_emissions(data) {
			// draw emissions dots on countries sized by emissions
			var emissions_2013 = data.filter(function (d) {return d.year === 2013;});
			for(var i=0; i<emissions_2013.length; i+=1){
				countries_loc[emissions_2013[i].country]['2013'] = emissions_2013[i].emissions ; 
			}

			debugger;
			var circles = d3.select("svg")
											.data(data)

		}
		d3.csv("emissions_stable.csv", function(d) {
				d["country"] = d["country"];
				d["year"] = new Date(d["year"]).getUTCFullYear();
				d["emissions"] = +d["emissions"];
				return d;
		}, plot_emissions);
	}

	</script>
</head>

<body>
	<script type="text/javascript">
	d3.json("world_countries_edited.json", draw);
	</script>
</body>
</html>
